# Proof of Concept for CVE-2024-9548 Slimstat - Blind UnAuth Stored XSS

The vulnerability in **Slimstat** arises from insufficient input validation within the WordPress `admin-ajax.php` endpoint. This Proof of Concept (PoC) demonstrates how an attacker can exploit this vulnerability to perform a **Stored Cross-Site Scripting (XSS)** attack, compromising the security of users interacting with the affected WordPress installation. This vulnerability is particularly dangerous because the malicious script is stored on the server, making it persistent and capable of affecting any user who accesses the compromised page.

The Slimstat plugin uses the `admin-ajax.php` endpoint to process AJAX requests, which are asynchronous HTTP requests allowing for dynamic interaction without requiring a full page refresh. Due to insufficient validation of user-supplied input, it becomes possible for an attacker to inject malicious payloads through this endpoint, which can later be rendered by the application and executed within other users' sessions.

## PoC Steps

### Step 1: Generate the Payload
- Construct an SVG payload embedding JavaScript code, such as `<svg onload="alert('XSS')">`. The SVG format is often used in XSS attacks as it allows embedding scripts in attributes like `onload`, which can execute JavaScript when the SVG element is rendered.
- Encode the payload using **HTML hexadecimal encoding** to bypass basic content filters (e.g., encode `<` as `&#x3c;`). This technique effectively disguises the payload to bypass naive filtering mechanisms.
- Apply **Base64 encoding** to the entire encoded string for additional obfuscation. Base64 encoding helps ensure that the payload can pass through input validation processes that might block obvious malicious strings.

### Step 2: Send the Payload
- Issue a **POST request** to the `admin-ajax.php` endpoint. This endpoint is utilized by the Slimstat plugin to handle incoming requests. Since it lacks proper input sanitization, it is vulnerable to malicious data.
- Use the `action=slimtrack` parameter, which is specific to the Slimstat plugin. This parameter tells Slimstat how to process the input data, which in this case leads to XSS.
- Include the vulnerable URL in the `ref` parameter, encoded in Base64 along with the appended payload.
- Ensure the `res` parameter is provided as a placeholder to meet the expected request structure.

### Example Request
```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: vulnerable-site.com
Content-Type: application/x-www-form-urlencoded

action=slimtrack&ref=aHR0cHM6Ly92dWxuZXJhYmxlLXNpdGUuY29tLzxzdmcgb25sb2FkPSdhbGVydChYc1NTKSc+&res=placeholder_value
```

The above request shows how the payload is delivered to the vulnerable endpoint using the `POST` method. The `action=slimtrack` instructs the Slimstat plugin to process the request, while the `ref` parameter contains the Base64-encoded payload.

## Automated Exploitation Using the Script
To automate the exploitation process, a script can be used to generate and send the payload to the vulnerable endpoint. Below is an example of how the exploitation can be automated:

1. **Script Overview**: The script takes a list of target URLs, generates the necessary payload, and sends the `POST` request to the `admin-ajax.php` endpoint for each target.
2. **Payload Generation**: The script uses functions to encode the payload in HTML hexadecimal and Base64 formats to evade basic filters.
3. **Request Sending**: The script automates the process of sending `POST` requests to the vulnerable endpoint, including necessary parameters such as `action`, `ref`, and `res`.
4. **Logging Results**: After sending the payload, the script logs the responses to determine if the target is vulnerable.

The exploit.py script demonstrates an automated way to exploit the vulnerability by generating the necessary payload and sending it to the target. This approach simplifies the exploitation process and allows for scalability in testing multiple targets.

## Security Implications

This vulnerability poses significant security risks:

- **Inadequate Input Sanitization**: Slimstat's use of `admin-ajax.php` without proper input filtering allows for the injection of malicious scripts. Without filtering user inputs, the application is susceptible to various code injection attacks.
- **Persistent XSS**: The injected JavaScript is stored in the database, resulting in a stored XSS vulnerability that re-executes whenever the infected page is accessed. Stored XSS attacks affect all users who visit the compromised page.
- **Severe Impact**: Attackers can manipulate or access sensitive data, escalate privileges, or use the compromised site for further attacks. This is especially dangerous for sites handling sensitive information, such as e-commerce platforms.

